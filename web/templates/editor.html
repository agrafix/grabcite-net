{% extends "layout.html" %}
{% block body %}
    <p>
        Enter a Computer-Science Paper Text below. Your input will turn green at locations where
        we recommend that you add a citation.
    </p>

    <hr />

    <div id="editor">
        <p><i>Your cool paper text goes here</i></p>
    </div>

    <script src="https://cdn.quilljs.com/1.3.1/quill.js"></script>

    <!-- Initialize Quill editor -->
    <script>
        var quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: false
            }
        });

        quill.on('text-change', function(delta, oldDelta, src) {
            if (src !== "user") {
                return;
            }
            var text = quill.getText();
            $.ajax({
                contentType: "application/json",
                data: JSON.stringify({ body: text }),
                dataType: "json",
                method: "POST",
                url: "/analyse"
            }).done(function(data) {
                for (var i in data.ranges) {
                    var range = data.ranges[i];
                    var start = range.rangeStart;
                    var end = range.rangeEnd;
                    var quoteProb = range.quote;
                    if (quoteProb < 0.45) {
                        quoteProb = 0;
                    }
                    var gv = Math.floor(255 * quoteProb);
                    quill.formatText(start, end - start, {
                        'color': 'rgb(0, ' + gv + ', 0)'
                    })
                }
            });
        });
    </script>
{% endblock %}